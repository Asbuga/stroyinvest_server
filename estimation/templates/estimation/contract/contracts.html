{% extends 'stroyinvest/base.html' %}

{% block title %}Договори{% endblock %}

{% block content %}

  <h3 class="d-flex justify-content-center align-items-center p-2 ">Договори</h3>
  
  <form method="get">
  {% csrf_token %}
  <div class="d-flex justify-content-between align-items-center">
    <div class="d-flex gap-2">

    <!-- Форма вибору місяця -->
    <label for="month" class="align-self-center">Місяць:</label>
    <select name="month" id="month" class="form-select w-auto">
      <option value="13">Всі місяці</option>
      {% for number, name in months %}
      <option value="{{ number }}" {% if selected_month|stringformat:"s" == number|stringformat:"s" %} selected {% endif %}>
        {{ name }}
      </option>
      {% endfor %}
    </select>

    <!-- Форма вибору року -->
    <label for="year" class="align-self-center">Рік:</label>
    <select name="year" id="year" class="form-select w-auto">
      {% for year in years %}
      <option value="{{ year }}" {% if selected_year|stringformat:"s" == year|stringformat:"s" %} selected {% endif %}>
        {{ year }}
      </option>
      {% endfor %}
    </select>
    <button type="submit" class="btn btn-primary">Оновити</button>
    </div>
  <a href="{% url 'estimation:add_contract' %}" class="btn btn-primary">Додати</a>
  </div>
  </br>
  <table class="table table-warning table-bordered table-hover text-center text-top">
    <thead>
    <tr class="align-middle">
      <th scope="col">Номер з/п</th>
      <th scope="col">Номер та дата договору</th>
      <th scope="col">Контрагент</th>
      <th scope="col">Найменування об'єкту</th>
      <th scope="col">За договором, грн.</th>
      <th scope="col">Виконано, грн.</th>
      <th scope="col">Залишок, грн.</th>
      <th scope="col">Примітка</th>
      <th scope="col">Вибрати</th>
    </tr>
    </thead>
    <tbody>
    {% for item in contract_performance %}
      {% with contract=item.contract acts_summ=item.acts_summ balance=item.balance %}
        <tr class="table-light">
          {% if forloop.first %}
            <td>{{ forloop.parentloop.counter }}</td>
            <td>{{ contract.number }} від {{ contract.date_signing|date:"d.m.Y" }}</td>
            <td>
              {% if contract.type == "ГП" %}
                {{ contract.customer }}
              {% else %}
                {{ contract.contractor }}
              {% endif %}
            </td>
            <td>{{ contract.subject_contract }}</td>
          {% endif %}
            <td class="fw-normal">{{ contract.summ|floatformat:"2"}}</td>
            <td class="fw-normal">{{ acts_summ|floatformat:"2"}}</td>
            <td class="fw-normal"> {{ balance|floatformat:"2" }} </td>
            <td class="fw-normal">{{ act.description|default:"-" }}</td>
            <td class="fw-normal">
              <input type="checkbox" name="selected_acts" value="{{ act.id }}">
            </td>
        </tr>
      {% endwith %}
    {% endfor %}
    <tr class="table-light">
      <td colspan="4"><b>ВСЬОГО</b></td>
      <td><b>{{ summ|floatformat:"2" }}</b></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    </tbody>
  </table>
  </form>
  </br>
  </br>
{% endblock %}
